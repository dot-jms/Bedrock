<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Access Portal</title>
<link rel="icon" href="favicon.png" type="image/png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root{
    --bg: linear-gradient(135deg, #020208 0%, #0a0a15 50%, #04040a 100%);
    --accent: #8ef6c1;
    --accent-hover: #a8ffdb;
    --accent-glow: rgba(142,246,193,0.4);
    --purple-strong: rgba(150,85,255,0.3);
    --purple-glow: rgba(150,85,255,0.2);
    --glass-border: rgba(255,255,255,0.12);
    --glass-bg: rgba(255,255,255,0.04);
    --shadow-epic: 0 35px 100px rgba(0,0,0,0.8), 0 15px 60px rgba(150,85,255,0.1);
    --gradient-accent: linear-gradient(135deg, var(--accent), #6ee7b7, var(--accent-hover));
    --gradient-glass: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.05) 50%, rgba(255,255,255,0.02) 100%);
    font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  }
  html,body{ height:100%; margin:0; background: var(--bg); background-attachment: fixed; color:#f8fafc; overflow:hidden; font-weight: 400; }
  *{box-sizing:border-box;}
  canvas#bg{ position:fixed; inset:0; z-index:0; pointer-events:none; display:block; filter: brightness(1.2) contrast(1.1); }
  .vignette{ position:fixed; inset:0; z-index:1; pointer-events:none; background:
    radial-gradient(50% 50% at 20% 20%, rgba(150,85,255,0.25), transparent 30%),
    radial-gradient(60% 60% at 80% 80%, rgba(122,58,210,0.20), transparent 35%),
    radial-gradient(40% 40% at 50% 10%, rgba(142,246,193,0.12), transparent 25%);
    mix-blend-mode: screen; animation: vignette-dance 15s ease-in-out infinite; }
  @keyframes vignette-dance { 0%,100%{opacity:1;transform:scale(1);}50%{opacity:0.8;transform:scale(1.05);} }
  .auth-wrap{ position:relative; z-index:2; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:32px; animation: grand-entrance 1.5s cubic-bezier(0.23, 1, 0.320, 1); }
  @keyframes grand-entrance { 0%{opacity:0;transform:translateY(60px) scale(0.9);filter:blur(20px);}100%{opacity:1;transform:translateY(0) scale(1);filter:blur(0);} }
  .auth-card{ width:100%; max-width:480px; padding:40px; border-radius:28px; background: var(--gradient-glass); border:1px solid var(--glass-border); box-shadow: var(--shadow-epic); position:relative; overflow:visible; backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); text-align:center; }
  .auth-card::before{ content:""; position:absolute; inset:-20px; border-radius:36px; z-index:-1; background: linear-gradient(135deg, var(--purple-strong), var(--purple-glow), rgba(142,246,193,0.15)); filter: blur(30px); pointer-events:none; animation: glow-breathe 8s ease-in-out infinite; }
  @keyframes glow-breathe { 0%,100%{opacity:0.8;transform:scale(1);}50%{opacity:1;transform:scale(1.1);} }
  .auth-card::after { content: ""; position: absolute; inset: -3px; border-radius: 31px; z-index: -1; background: linear-gradient(45deg, transparent, rgba(142,246,193,0.1), transparent, rgba(150,85,255,0.1), transparent); animation: border-glow 12s linear infinite; }
  @keyframes border-glow { 0%{transform:rotate(0deg);}100%{transform:rotate(360deg);} }
  .auth-title { font-size: 32px; font-weight: 900; margin: 0 0 12px 0; background: linear-gradient(135deg, #ffffff 0%, var(--accent) 50%, #a855f7 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 0 30px rgba(142,246,193,0.3); animation: title-glow 6s ease-in-out infinite; }
  @keyframes title-glow { 0%,100%{filter:brightness(1);}50%{filter:brightness(1.3);} }
  .auth-subtitle { color: rgba(255,255,255,0.7); font-size: 16px; margin-bottom: 40px; font-weight: 500; }
  .key-input { width: 100%; padding: 18px 24px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #f8fafc; font-size: 16px; font-weight: 600; text-align: center; letter-spacing: 2px; margin-bottom: 24px; transition: all 0.3s; backdrop-filter: blur(10px); }
  .key-input:focus { outline: none; border-color: var(--accent); background: rgba(255,255,255,0.08); box-shadow: 0 0 30px rgba(142,246,193,0.2); transform: scale(1.02); }
  .access-btn { width: 100%; padding: 18px 32px; border-radius:16px; border:0; background: var(--gradient-accent); color:#0a0a0a; font-weight:900; font-size:18px; cursor:pointer; transition: all 0.3s; box-shadow: 0 20px 50px rgba(10,20,20,0.6), 0 0 0 1px rgba(255,255,255,0.1) inset; position: relative; overflow: hidden; letter-spacing:1px; }
  .access-btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition: left 0.6s ease; }
  .access-btn:hover::before { left: 100%; }
  .access-btn:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 30px 70px rgba(150,85,255,0.2), 0 0 40px rgba(142,246,193,0.3); }
  .access-btn:active { transform: translateY(0) scale(0.98); }
  .access-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
  .error-msg { color: #ff6b6b; font-size: 14px; font-weight: 600; margin-top: 16px; opacity: 0; transition: opacity 0.3s ease; text-shadow: 0 0 10px rgba(255,107,107,0.3); }
  .error-msg.show { opacity: 1; animation: shake 0.5s ease-in-out; }
  @keyframes shake { 0%,100%{ transform: translateX(0); }25%{ transform: translateX(-5px);}75%{ transform: translateX(5px);} }
  .success-msg { color: var(--accent); font-size: 14px; font-weight: 600; margin-top: 16px; opacity: 0; transition: opacity 0.3s ease; text-shadow: 0 0 10px var(--accent-glow); }
  .success-msg.show { opacity: 1; animation: success-pulse 0.6s ease-out; }
  @keyframes success-pulse { 0%{ transform: scale(1); }50%{ transform: scale(1.05);}100%{ transform: scale(1);} }
  .loading { display: none; margin-top: 16px; }
  .spinner { width: 24px; height: 24px; border: 2px solid rgba(142,246,193,0.2); border-top: 2px solid var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto; }
  @keyframes spin { 0%{ transform: rotate(0deg); }100%{ transform: rotate(360deg); } }
  @media (max-width:520px){ .auth-card{ padding:28px; border-radius:20px } .auth-title{ font-size:28px } .launch-title{ font-size:36px } }
</style>
</head>
<body>
  <canvas id="bg"></canvas>
  <div class="vignette"></div>

  <div class="auth-wrap">
    <div class="auth-card">
      <h1 class="auth-title">BEDROCK</h1>
      <p class="auth-subtitle">Enter your access key to continue</p>
      
      <input type="password" 
             class="key-input" 
             id="keyInput" 
             placeholder="ACCESS KEY" 
             autocomplete="off">
      
      <!-- explicit type so it won't act like a submit button -->
      <button class="access-btn" id="accessBtn" type="button">
        GRANT ACCESS
      </button>
      
      <div class="loading" id="loading">
        <div class="spinner"></div>
      </div>
      
      <div class="error-msg" id="errorMsg">Invalid access key. Please try again.</div>
      <div class="success-msg" id="successMsg">Access granted. Launching Bedrock...</div>
    </div>
  </div>

  <script>
  // run all UI logic after DOM loads
  window.addEventListener('DOMContentLoaded', () => {
    console.log('DOM ready — initializing Bedrock auth UI');

    // UI elements
    const keyInput = document.getElementById('keyInput');
    const accessBtn = document.getElementById('accessBtn');
    const errorMsg = document.getElementById('errorMsg');
    const successMsg = document.getElementById('successMsg');
    const loading = document.getElementById('loading');

    // helpers
    function showError() {
      console.log('showError');
      errorMsg.classList.add('show');
      setTimeout(() => errorMsg.classList.remove('show'), 3000);
    }
    function showSuccess() {
      console.log('showSuccess');
      successMsg.classList.add('show');
    }
    function showLoading(show) {
      loading.style.display = show ? 'block' : 'none';
      accessBtn.disabled = show;
    }

    // key logic
    const VALID_KEY = "BEDROCK2025";

    function validateKey() {
      const key = keyInput.value.trim().toUpperCase();
      if (!key) { keyInput.focus(); return; }
      showLoading(true);
      // simulate server check
      setTimeout(() => {
        if (key === VALID_KEY) {
          showSuccess();
          try { localStorage.setItem('bedrock_auth', 'authorized'); } catch(e) { console.warn('localStorage failed', e); }
          setTimeout(() => launchBedrockPad(), 1400);
        } else {
          showLoading(false);
          showError();
          keyInput.value = '';
          keyInput.focus();
        }
      }, 900);
    }

    accessBtn.addEventListener('click', validateKey);
    keyInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') validateKey(); });
    keyInput.focus();

    // starfield background — guarded so it can't break clicks
    try {
      (function starfield() {
        const canvas = document.getElementById('bg');
        if (!canvas) { console.warn('bg canvas not found'); return; }
        const ctx = canvas.getContext('2d');
        let w = canvas.width = innerWidth;
        let h = canvas.height = innerHeight;
        const STAR_COUNT = Math.max(60, Math.floor((w*h)/2000));
        const stars = [];
        const nebula = [];
        function rand(min,max){ return Math.random()*(max-min)+min }

        for(let i=0;i<STAR_COUNT;i++){
          stars.push({
            x: Math.random()*w,
            y: Math.random()*h,
            z: rand(0.3,2.0),
            r: rand(0.8,4.0),
            vx: rand(-0.03,0.03),
            vy: rand(-0.06,0.06),
            t: Math.random()*15,
            color: Math.random() > 0.93 ? 'rgba(142,246,193,0.8)' : Math.random() > 0.95 ? 'rgba(168,85,247,0.7)' : 'white',
            twinkleSpeed: rand(0.3, 1.5)
          });
        }

        for(let i=0;i<6;i++){
          nebula.push({
            x: Math.random()*w,
            y: Math.random()*h,
            r: rand(120,300),
            vx: rand(-0.015,0.015),
            vy: rand(-0.015,0.015),
            opacity: Math.max(0.02, Math.min(0.18, rand(0.03,0.12))),
            color: Math.random() > 0.5 ? 'rgba(142,246,193,' : 'rgba(168,85,247,'
          });
        }

        function resize(){ w = canvas.width = innerWidth; h = canvas.height = innerHeight; }
        window.addEventListener('resize', resize);

        function draw(){
          ctx.clearRect(0,0,w,h);
          const g1 = ctx.createRadialGradient(w*0.2,h*0.2,0,w*0.2,h*0.2,Math.max(w,h)*0.8);
          g1.addColorStop(0,'rgba(15,10,25,0.2)');
          g1.addColorStop(0.6,'rgba(8,5,15,0.3)');
          g1.addColorStop(1,'rgba(2,2,8,0.4)');
          ctx.fillStyle = g1;
          ctx.fillRect(0,0,w,h);

          const t = Date.now()/4000;

          for(const n of nebula){
            n.x += n.vx;
            n.y += n.vy;
            if(n.x < -n.r) n.x = w + n.r;
            if(n.x > w + n.r) n.x = -n.r;
            if(n.y < -n.r) n.y = h + n.r;
            if(n.y > h + n.r) n.y = -n.r;

            const pulse = Math.abs(Math.sin(t * 0.4 + n.x * 0.001));
            ctx.beginPath();
            ctx.globalAlpha = Math.max(0, Math.min(1, n.opacity * pulse));
            const g = ctx.createRadialGradient(n.x,n.y,0,n.x,n.y,n.r);
            g.addColorStop(0, n.color + (n.opacity * 3) + ')');
            g.addColorStop(1, 'transparent');
            ctx.fillStyle = g;
            ctx.arc(n.x, n.y, n.r, 0, Math.PI*2);
            ctx.fill();
          }

          for(const s of stars){
            s.x += s.vx * (s.z*1.5);
            s.y += s.vy * (s.z*1.5);

            const twinkle = Math.abs(Math.sin(t * s.twinkleSpeed + s.t)) * Math.abs(Math.cos(t * s.twinkleSpeed * 0.6 + s.t * 0.4));

            if(s.x<0) s.x = w;
            if(s.x>w) s.x = 0;
            if(s.y<0) s.y = h;
            if(s.y>h) s.y = 0;

            ctx.beginPath();
            ctx.globalAlpha = 0.6 + 0.4 * s.z * (0.4 + twinkle*0.6);
            ctx.fillStyle = s.color;
            ctx.arc(s.x, s.y, s.r * s.z, 0, Math.PI*2);
            ctx.fill();

            if(s.color !== 'white' && twinkle > 0.7){
              ctx.beginPath();
              ctx.globalAlpha = 0.2 * s.z * twinkle;
              ctx.arc(s.x, s.y, s.r * s.z * 2.5, 0, Math.PI*2);
              ctx.fill();
            }
            ctx.globalAlpha = 1;
          }

          requestAnimationFrame(draw);
        }
        draw();
      })();
    } catch (err) {
      console.error('Starfield init failed:', err);
    }

    // launch pad creator — writes full launch pad HTML into a new tab and calls document.close()
    window.launchBedrockPad = function() {
      try {
        const launchWindow = window.open('', '_blank');
        if (!launchWindow) {
          alert('Pop-up blocked — allow pop-ups for this site to open the launch pad.');
          console.warn('window.open returned null — possibly blocked by browser');
          // If blocked, fallback by navigating current tab (optional)
          // window.location.href = 'portal.html';
          showLoading(false);
          return;
        }

        const launchHtml = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>BEDROCK — Launch Pad</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{ --bg: linear-gradient(135deg,#020208 0%,#0a0a15 50%,#04040a 100%); }
    html,body{height:100%;margin:0;background:var(--bg);color:#f8fafc;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;overflow:hidden;display:flex;align-items:center;justify-content:center}
    canvas{position:fixed;inset:0;z-index:0}
    .launch-container{position:relative;z-index:2;text-align:center;animation:fadeIn 1.6s ease-out}
    @keyframes fadeIn{0%{opacity:0;transform:scale(.95)}100%{opacity:1;transform:scale(1)}}
    .launch-title{font-size:48px;font-weight:900;margin-bottom:24px;background:linear-gradient(135deg,#fff,#8ef6c1,#a855f7);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .launch-btn{padding:20px 40px;border-radius:20px;border:0;background:linear-gradient(135deg,#8ef6c1,#a8ffdb);color:#0a0a0a;font-weight:900;font-size:18px;cursor:pointer;box-shadow:0 20px 60px rgba(142,246,193,0.3)}
    .launch-btn:active{transform:scale(.98)}
    @media (max-width:520px){ .launch-title{font-size:32px} .launch-btn{padding:18px 28px} }
  </style>
</head>
<body>
  <canvas id="nebula"></canvas>
  <div class="launch-container">
    <h1 class="launch-title">BEDROCK</h1>
    <button class="launch-btn" id="doLaunch">LAUNCH BEDROCK</button>
    <p style="opacity:.75;margin-top:12px;font-size:13px">Click to load the portal (this is a user gesture so pop-up blockers won't stop it).</p>
  </div>

  <script>
    // graceful nebula background
    (function() {
      const canvas = document.getElementById('nebula');
      const ctx = canvas.getContext('2d');
      let w = canvas.width = innerWidth;
      let h = canvas.height = innerHeight;
      const particles = [];
      for(let i=0;i<120;i++){
        particles.push({
          x: Math.random()*w,
          y: Math.random()*h,
          vx: (Math.random()-0.5)*0.6,
          vy: (Math.random()-0.5)*0.6,
          size: Math.random()*3+0.5,
          hue: Math.random()*60 + 180
        });
      }
      function animate(){
        ctx.fillStyle = 'rgba(2,2,8,0.06)';
        ctx.fillRect(0,0,w,h);
        particles.forEach(p => {
          p.x += p.vx; p.y += p.vy;
          if(p.x < -10) p.x = w + 10;
          if(p.x > w + 10) p.x = -10;
          if(p.y < -10) p.y = h + 10;
          if(p.y > h + 10) p.y = -10;
          ctx.beginPath();
          ctx.fillStyle = 'hsla(' + p.hue + ',70%,60%,0.6)';
          ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
          ctx.fill();
        });
        requestAnimationFrame(animate);
      }
      animate();
      window.addEventListener('resize', ()=>{ w = canvas.width = innerWidth; h = canvas.height = innerHeight; });
    })();

    // Launch action — fetch portal.html and replace document content with it.
    document.getElementById('doLaunch').addEventListener('click', function() {
      // use fetch and replace current doc content — user gesture present so navigation is allowed
      fetch('portal.html').then(r => {
        if (!r.ok) throw new Error('portal not found');
        return r.text();
      }).then(html => {
        document.open();
        document.write(html);
        document.close();
      }).catch(err => {
        console.warn('fetch portal failed, falling back to iframe', err);
        document.open();
        document.write('<iframe src="portal.html" style="width:100vw;height:100vh;border:none;margin:0;padding:0;"></iframe>');
        document.close();
      });
    });
  </script>
</body>
</html>
        `;

        // write and close so the new tab finishes parsing and runs its scripts
        launchWindow.document.open();
        launchWindow.document.write(launchHtml);
        launchWindow.document.close();

        // keep the auth tab open (safer for debugging). If you want it to close automatically uncomment next line:
        // try { window.close(); } catch(e) { console.warn('could not close origin window', e); }

        // hide loading once new tab is open
        showLoading(false);
      } catch (e) {
        console.error('launchBedrockPad failed', e);
        showLoading(false);
      }
    }; // end launchBedrockPad
  }); // end DOMContentLoaded
  </script>
</body>
</html>
